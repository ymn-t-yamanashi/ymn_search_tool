<script>
  document.addEventListener('keydown', (event) => {
    focus = document.querySelector("textarea:focus-visible, input:focus-visible")
    if (focus != null) return 
    keyAssign(event, "g", "gemini")
    keyAssign(event, "c", "clear")
    for(i = 1; i <= 7; i++) {
      keyAssign(event, i, "link" + i)
    }

  });
  function copy(){
    let llm = document.querySelector("#llm")
    let value = llm.value

    navigator.clipboard.writeText(value)
  } 

  function readText(){
    let questionType = document.querySelector("#question_type")
     navigator.clipboard.readText()
      .then(text => {
        location.href="/?q=" + text + "&question_type=" + questionType.value
    })
  }

  function keyAssign(event, key, id) {
    if(event.key == key) document.querySelector("#" + id).click()
  }
</script>
<div class="flex flex-row h-screen gap-x-6">
  <div>
    検索ワード
    <a
      id="clear"
      href="#"
      phx-click="clear-click"
      class="rounded-lg bg-violet-900 px-2 text-white mt-20"
    >
      クリア(c)
    </a>
    <a
      id="#getclip"
      href="#"
      onclick="readText()"
      class="rounded-lg bg-violet-900 px-2 text-white mt-20"
    >
      クリックボードから取得
    </a>
    <form phx-change="change" phx-submit="submit">
      <input id="q" type="text" name="q" value={@q} />
      <select id="question_type" name="question_type">
        <%= for {value, name} <- @question_types do %>
          <%= if @question_type == value do %>
            <option value={value} selected><%= name %></option>
          <% else %>
            <option value={value}><%= name %></option>
          <% end %>
        <% end %>
      </select>

      <select id="llm_type" name="llm_type">
        <%= for {value, name} <- @llm_types do %>
          <%= if @llm_type == value do %>
            <option value={value} selected><%= name %></option>
          <% else %>
            <option value={value}><%= name %></option>
          <% end %>
        <% end %>
      </select>
    </form>
    <br /> キー割当:()中のキーになります 例えば「g」キーを押すと「gemini」が起動します <br />
    <br />
    <%= for {link, index} <- Enum.with_index(@links, 1) do %>
      <% id = "link#{index}" %>
      <a
        id={id}
        class="rounded-lg bg-violet-600 w-12 px-2 text-white mt-20"
        href={link.url}
        target="_blank"
        noopener
        noreferrer
      >
        <%= link.text %>で検索<%= "(#{index})" %>
      </a>
      <br />
    <% end %>
    <br />
    <br /> LLM用プロンプト<br />
    <br />
    <a
      id="gemini"
      onclick="copy()"
      class="rounded-lg bg-violet-600 w-12 px-2 text-white mt-20"
      href="https://gemini.google.com/app"
      target="_blank"
      noopener
      noreferrer
    >
      geminiを起動(g)
    </a>
    <br /> プロンプトはクリックボードにコピーされます<br /> geminiを起動後手動で貼り付け(Ctrl + v)てください <br />
    <br />
    <textarea id="llm" style="height: 300px; width:400px" name="text"><%= @prompt %></textarea>
  </div>
  <div class="w-min-96 overflow-y-scroll max-h-[800px]">
    <%= for word <- @word_list do %>
      <% bg = if word == @q, do: "bg-cyan-500", else: "bg-cyan-800" %>
      <a
        href="#"
        phx-value-word={word}
        phx-click="word"
        class={"w-80 text-sm rounded-lg " <>  bg  <> " px-2 m-1 text-white"}
      >
        <%= word %>
      </a>
      <br />
    <% end %>
  </div>
</div>
